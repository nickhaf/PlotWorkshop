---
title: "Informatio"
format: 
  letterbox-revealjs:
    code-block-height: 650px
bibliography: refs.bib
---



```{r}
#| label: Load pacakges
#| echo: false
#| message: false

library(here)
library(janitor)
library(ggwordcloud)
library(ggrepel)
library(ggtext)
library(tidyverse)
source(here::here("src", "themes.R"))
source(here::here("src", "functions.R"))

gapminder <- readRDS(here::here("data", "gapminder_dat.rds"))

gapminder_europe <- gapminder %>%
  filter(world_4region == "europe", time >= 1900, time <= 2024) %>%
  drop_na(gini)

gapminder_2020 <- gapminder %>%
  filter(time == 2020) %>%
  drop_na(world_6region, world_4region, country, gini, hapiscore_whr) %>% 
  arrange(desc(co2_cons))
```

# Story


::: {.columns}

::: {.column width="50%"}

::: {.quote}
Just as writing is made more compelling by a [strong narrative]{.highlight}, this principle also applies to the accompanying figures. ([nature methods](https://www.nature.com/articles/nmeth.2571)) 
:::


:::

::: {.column width="50%"}
![](images/library.jpg){.image-right}

:::
:::


::: {.image-ref}
Foto von <a href="https://unsplash.com/de/@henry_be?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Henry Be</a> auf <a href="https://unsplash.com/de/fotos/bibliotheksregal-in-der-nahe-der-schwarzen-holzleiter-lc7xcWebECc?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
:::


## Story-Arc

```{r}
#| echo: false

extrafont::loadfonts()
library(tidyverse)
library(ggridges)
library(viridis)
library(extrafont)
library(cowplot)
library(showtext)

# Loading fonts
font_add_google("DM Serif Display", "abril")
font_add_google("Tajawal", "tawa")
showtext_auto()

# Set theme
theme_set(theme_light())
# Loading data
babynames <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-03-22/babynames.csv")

# 50 most popular female names over all time
top_female <- babynames |>
  filter(sex == "F") |>
  group_by(name) |>
  summarise(total = sum(n)) |>
  slice_max(total, n = 50) |>
  mutate(
    rank = 1:50,
    name = forcats::fct_reorder(name, -total)
  ) |>
  pull(name)

# 50 most popular male names over all time
top_male <- babynames |>
  filter(sex == "M") |>
  group_by(name) |>
  summarise(total = sum(n)) |>
  slice_max(total, n = 50) |>
  mutate(
    rank = 1:50,
    name = forcats::fct_reorder(name, -total)
  ) |>
  pull(name)

# filter female names data
female_names <- babynames |>
  filter(
    sex == "F",
    name %in% top_female
  ) |>
  mutate(name = factor(name, levels = levels(top_female))) |>
  group_by(year, name) |>
  summarise(n = sum(n))

# filter top males
male_names <- babynames |>
  filter(
    sex == "M",
    name %in% top_male
  ) |>
  mutate(name = factor(name, levels = levels(top_male))) |>
  group_by(year, name) |>
  summarise(n = sum(n))


plot1 <- ggplot(female_names, aes(year,
  y = fct_reorder(name, n), height = n / 50000,
  group = name, scale = 2
)) +
  geom_ridgeline(
    alpha = 0.5, scale = 4.5, linewidth = 0,
    fill = "#05595B", color = "white"
  ) +
  xlim(1900, NA) +
  labs(title = "Female", y = "", x = "") +
  theme(
    plot.title = element_text(hjust = 0, family = "Bahnschrift", size = 20),
    axis.ticks.y = element_blank(),
    axis.text = element_text(family = "Bahnschrift", size = 15),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(size = 0.5),
    panel.border = element_blank()
  ) +
  geom_segment(aes(x = 1967, xend = 1967, y = 56.7, yend = 52), color = "#404040") +
  geom_segment(aes(x = 1967, xend = 1964, y = 56.7, yend = 56.7), color = "#404040") +
  annotate(
    geom = "text", x = 1970, y = 57, label = "73,982 babies called\n'Mary' in 1921", hjust = "left",
    size = 7, color = "#404040", family = "Bahnschrift"
  )


plot2 <- ggplot(male_names, aes(year,
  y = fct_reorder(name, n), height = n / 50000,
  group = name, scale = 2
)) +
  geom_ridgeline(
    alpha = 0.5, scale = 4.5, linewidth = 0,
    fill = "#603601", color = "white"
  ) +
  xlim(1900, NA) +
  labs(title = "Male", y = "", x = "") +
  theme(
    plot.title = element_text(hjust = 0, family = "Bahnschrift", size = 20),
    axis.ticks.y = element_blank(),
    axis.text = element_text(family = "Bahnschrift", size = 15),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(size = 0.5),
    panel.border = element_blank(),
    panel.background = element_rect(fill = "white"),
    plot.background = element_rect(fill = "white")
  ) +
  geom_segment(aes(x = 1975, xend = 1975, y = 58, yend = 53.1), color = "#404040") +
  geom_segment(aes(x = 1975, xend = 1972, y = 58, yend = 58), color = "#404040") +
  annotate(
    geom = "text", x = 1977, y = 57.6, label = "94,756 babies called\n'James' in 1947", hjust = "left",
    size = 7, color = "#404040", family = "Bahnschrift"
  )


title_theme <- ggdraw() +
  draw_label("50 most common given names in the US since 1900",
    fontfamily = "Gadugi",
    fontface = "bold",
    size = 45,
    hjust = 0.4
  )

# caption
caption <- ggdraw() +
  draw_label("Source: {babynames} from Hadley Wickham | Graphic: Laura Navarro Soler",
    fontfamily = "Bahnschrift",
    size = 25,
    hjust = 0.5,
    color = "#6B6B6B"
  )

gridofplots <- plot_grid(plot1, plot2, nrow = 1)
plot_grid(title_theme,
  gridofplots,
  caption,
  ncol = 1, rel_heights = c(0.2, 1.5, 0.1)
)
```

::: image-ref
Abbildung von [Laura Navarro Soler](https://r-graph-gallery.com/web-double-ridgeline-plot.html).
:::

## Story-Arc

![](./images/food_deserts.png){.lightbox}

::: {.image-ref}
Abbildung von [Corey Jones](https://public.tableau.com/app/profile/corey.jones/viz/FindingOasesInFoodDeserts/Dashboard1).
:::


## Episodische Grafik, lass es sich entfalten. 

![](./images/water_world.png)

::: {image-ref}
Bild von [information is beautiful](https://informationisbeautiful.net/visualizations/water-world-distribution-of-the-all-the-water-in-all-the-world/).
:::


- “If your study were reported in the newspaper, what would the headline be?”


## Bewerten der Informationen 

![](./images/hollywood.png)

## Zusätzliche Informationen einbauen

::: {.panel-tabset}

### Plot

```{r}
#| label: line_labels
#| fig-width: 14
#| fig-height: 7
#| echo: false

gapminder_line <- gapminder %>%
  filter(country %in% c("deu"), time >= 1900, time <= 2024) %>%
  drop_na(gini)

steuer <- gapminder_line %>%
  filter(time %in% c(1914, 1920, 1939, 1945, 1974, 1990, 1991, 1996, 2020), country == "deu") %>%
  arrange(time) %>%
  mutate(label = c("Beginn 1. WK", "Reichseinkommensteuer", "Beginn 2. WK", "Starke Anhebung durch Alliiert", "Einkommenssteuerreformgesetz", "Wiedervereinigung", "Linear-Progressiver Tarif", "Anhebung Freibetrage", "Corona"))

p_line <- ggplot(data = gapminder_line, aes(x = time, y = gini)) +
  theme_bg_dark() +
  geom_line(data = gapminder_europe, aes(x = time, y = gini, group = country), color = "#F8F8F8", alpha = 0.2) +
  geom_line(color = "#F4BA02", linewidth = 2) +
  geom_point(data = steuer) +
  geom_text_repel(
    data = steuer, aes(label = label), nudge_x = c(20, 25, 10, -5, 0, 0, -10), nudge_y = c(2, 2, 2, -2, 1, -2, 1),
    color = "#F4BA02"
  ) +
  labs(
    title = "Ungleichheit in Deutschland On the Rise?",
    subtitle = "Gini-Koeffizient von 1850 bis 2024",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  geom_richtext(
    data = data.frame(
      x = 1900, y = 20,
      label = "<b>Gini-Koeffizient</b>: <br> Maß für Ungleichheit. <br> In diesem Fall Einkommen.<br>0 = vollkommen gleich <br> 100 = maximal ungleich."
    ),
    aes(x, y, label = label),
    hjust = 0, vjust = 0,
    fill = "#F4BA02", label.color = "#01364C",
    label.r = grid::unit(3, "pt"),
    size = 5
  )

p_line

## Add a plot on vermogen!! Evtl. einfach den Gini Koeffizienten fur ein Paar Jahre, die ich habe

## https://www.econtribute.de/RePEc/ajk/ajkpbs/ECONtribute_PB_001_2020.pdf
```

### Code
```{r}
#| label: line_labels
#| eval: false
```

:::

## Vergleichen


::: {.panel-tabset}

### Plot
```{r}
#| label: merged_lineplot
#| echo: false


#
# World Inequality Lab – Working Paper N° 2022/09
# Wealth and its Distribution in Germany,
# 1895-2018

df <- data.frame(
  year = c(
    1895, 1900, 1905, 1910, 1915, 1920, 1925, 1930, 1935, 1940,
    1945, 1950, 1955, 1960, 1965, 1970, 1975, 1980, 1985, 1990,
    1995, 2000, 2005, 2010, 2015, 2018
  ),
  top1_share_percent = c(
    46, 47, 47.5, 48, 47.5, 45, 36, 41, 38, 33,
    28, 23, 22, 23, 21, 24, 28, 27, 26, 25.5,
    26, 27, 26.5, 28.5, 27, 28
  )
)

ggplot(df, aes(year, top1_share_percent)) +
  geom_line() +
  geom_point() +
  ylim(c(0, 50))



dat_eink <- data.frame(
  country = rep(c("Schweiz", "Deutschland", "Österreich"), 4),
  Steuer = c(rep("Erbschaft", 3), rep("Vermögen", 3), rep("Konsum", 3), rep("Unternehmen", 3)),
  anteil = c(1, 0, 1, 7, 0, 0, 26, 41, 43, 15, 12, 10)
)

p_bar <- ggplot(dat_eink, aes(x = reorder(Steuer, anteil), y = anteil, fill = Steuer)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(vars(country)) +
  theme_bg() +
  labs(
    title = "Steueraufkommen in % des BIP",
    subtitle = "Haushaltsjahr 2022",
    x = "Steuerart",
    y = "Anteil am BIP in %"
  ) +
  geom_text(aes(label = anteil),
    position = position_dodge(width = 0.9),
    vjust = -0.25
  ) +
  theme_bg_dark()


# https://www.wsi.de/de/blog-17857-vermoegensteuer-geht-die-schweiz-widerlegt-den-mythos-vom-unmoeglichen-68853.htm


gapminder_usa <- gapminder %>%
  filter(country %in% c("usa"), time >= 1850, time <= 2024) %>%
  drop_na(gini)

p_line_usa <- ggplot(data = gapminder_usa, aes(x = time, y = gini, color = country)) +
  geom_line() +
  theme_bg() +
  labs(
    title = "Einkommens- und Erbschaftssteuer in den USA",
    subtitle = "Gini-Koeffizient von 1850 bis 2024",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  geom_richtext(
    data = data.frame(
      x = 1850, y = 30,
      label = "Zwischen 1930 und 1980 wurden in den Vereinigten Staaten die höchsten Einkommen durchschnittlich mit 81 Prozent besteuert und die größten vererbten Vermögen mit 74 Prozent."
    ),
    aes(x, y, label = label),
    inherit.aes = FALSE,
    hjust = 0, vjust = 0,
    fill = "white", label.color = "black",
    label.r = grid::unit(3, "pt"),
    size = 3.5
  ) +
  theme_bg_dark()





## Eine Vermogenssteuer hat das potenzial, Ungleichheit zu reduzieren, und die Abgabenlast von Konsumsteuern zu reduzieren.
## Die USA hatten in den 80 Jahren eine 80% Vermogenssteuer.


library(patchwork)


p_line +
  annotation_custom(ggplotGrob(p_bar),
    xmin = 1980, ymin = 43,
    xmax = 2020
  ) +
  p_line_usa +
  plot_layout(widths = c(2, 1))
```

```{r}
#| label: merged_lineplot
#| eval: false
```

::: 

## 

::: {.exercise}

1. Was wäre die Überschrift für eure Grafik, wenn sie in der Zeitung stehen würde?
1. Welche Infos sind noch notwendig, um die Grafik zu verstehen? Wo könnte man sie einbauen?
1. Soll die Abbildung aus mehreren Plots bestehen? In welcher Reihenfolge?

:::

