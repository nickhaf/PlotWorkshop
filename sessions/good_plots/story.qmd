---
title: "Story"
title-slide-attributes:
  data-background-image: ./images/library.jpg
  data-background-size: cover
format: 
  letterbox-revealjs:
    code-block-height: 650px
bibliography: refs.bib
---



```{r}
#| label: Load pacakges
#| echo: false
#| message: false

library(here)
library(janitor)
library(ggwordcloud)
library(ggrepel)
library(ggtext)
library(tidyverse)
source(here::here("src", "themes.R"))
source(here::here("src", "functions.R"))

```

## Setup

```{r}
# install.packages("tidyverse")

library(tidyverse)

gapminder <- readRDS(here::here("data", "gapminder_dat.rds"))

gapminder_europe <- gapminder %>%
  filter(world_4region == "europe", time >= 1900, time <= 2024) %>%
  drop_na(gini)

gapminder_2020 <- gapminder %>%
  filter(time == 2020) %>%
  drop_na(world_6region, world_4region, country, gini, hapiscore_whr) %>% 
  arrange(desc(co2_cons))
```

# Story


::: {.columns}

::: {.column width="50%"}

\

::: {.quote}
Just as writing is made more compelling by a [strong narrative]{.highlight}, this principle also applies to the accompanying figures. 

::: {.small}
[nature methods](https://www.nature.com/articles/nmeth.2571)
:::

:::


:::

::: {.column width="50%"}
![](images/library.jpg){.image-right}

:::
:::


::: {.image-ref}
Foto von <a href="https://unsplash.com/de/@henry_be?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Henry Be</a> auf <a href="https://unsplash.com/de/fotos/bibliotheksregal-in-der-nahe-der-schwarzen-holzleiter-lc7xcWebECc?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
:::


## Exploration


```{r}
#| echo: false
#| fig-width: 16
#| fig-height: 10

extrafont::loadfonts()
library(tidyverse)
library(ggridges)
library(viridis)
library(extrafont)
library(cowplot)
library(showtext)

# Loading fonts
font_add_google("DM Serif Display", "abril")
font_add_google("Tajawal", "tawa")
showtext_auto()

# Set theme
theme_set(theme_light())
# Loading data
babynames <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-03-22/babynames.csv")

# 50 most popular female names over all time
top_female <- babynames |>
  filter(sex == "F") |>
  group_by(name) |>
  summarise(total = sum(n)) |>
  slice_max(total, n = 50) |>
  mutate(
    rank = 1:50,
    name = forcats::fct_reorder(name, -total)
  ) |>
  pull(name)

# 50 most popular male names over all time
top_male <- babynames |>
  filter(sex == "M") |>
  group_by(name) |>
  summarise(total = sum(n)) |>
  slice_max(total, n = 50) |>
  mutate(
    rank = 1:50,
    name = forcats::fct_reorder(name, -total)
  ) |>
  pull(name)

# filter female names data
female_names <- babynames |>
  filter(
    sex == "F",
    name %in% top_female
  ) |>
  mutate(name = factor(name, levels = levels(top_female))) |>
  group_by(year, name) |>
  summarise(n = sum(n))

# filter top males
male_names <- babynames |>
  filter(
    sex == "M",
    name %in% top_male
  ) |>
  mutate(name = factor(name, levels = levels(top_male))) |>
  group_by(year, name) |>
  summarise(n = sum(n))


plot1 <- ggplot(female_names, aes(year,
  y = fct_reorder(name, n), height = n / 50000,
  group = name, scale = 2
)) +
  geom_ridgeline(
    alpha = 0.5, scale = 4.5, linewidth = 0,
    fill = "#05595B", color = "#E1E8EB"
  ) +
  xlim(1900, NA) +
  labs(title = "Female", y = "", x = "") +
  theme_bg() +
  theme(
    plot.title = element_text(hjust = 0, family = "Bahnschrift", size = 50),
    axis.ticks.y = element_blank(),
    axis.text = element_text(family = "Bahnschrift", size = 23),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(size = 0.5),
    panel.border = element_blank()
  ) +
  geom_segment(aes(x = 1967, xend = 1967, y = 56.7, yend = 52), color = "#404040") +
  geom_segment(aes(x = 1967, xend = 1964, y = 56.7, yend = 56.7), color = "#404040") +
  annotate(
    geom = "text", x = 1970, y = 57, label = "73,982 babies called\n'Mary' in 1921", hjust = "left",
    size = 7, color = "#404040", family = "Bahnschrift"
  )


plot2 <- ggplot(male_names, aes(year,
  y = fct_reorder(name, n), height = n / 50000,
  group = name, scale = 2
)) +
  geom_ridgeline(
    alpha = 0.5, scale = 4.5, linewidth = 0,
    fill = "#603601", color = "#E1E8EB"
  ) +
  xlim(1900, NA) +
  labs(title = "Male", y = "", x = "") +
  theme_bg() +
  theme(
    plot.title = element_text(hjust = 0, family = "Bahnschrift", size = 50),
    axis.ticks.y = element_blank(),
    axis.text = element_text(family = "Bahnschrift", size = 23),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y = element_line(size = 0.5),
    panel.border = element_blank()
  ) +
  geom_segment(aes(x = 1975, xend = 1975, y = 58, yend = 53.1), color = "#404040") +
  geom_segment(aes(x = 1975, xend = 1972, y = 58, yend = 58), color = "#404040") +
  annotate(
    geom = "text", x = 1977, y = 57.6, label = "94,756 babies called\n'James' in 1947", hjust = "left",
    size = 7, color = "#404040", family = "Bahnschrift"
  )


title_theme <- ggdraw() +
  draw_label("50 most common given names in the US since 1900",
    fontfamily = "Gadugi",
    fontface = "bold",
    size = 45,
    hjust = 0.4
  )

library(patchwork)

plot1 + plot2 +
  plot_annotation(
    title = "50 most common given names in the US since 1900",
    theme = theme(
      plot.title = element_text(
        size = 30,
        hjust = 0.5, face = "bold"
      ),
      strip.background = element_rect(fill = "#F8F8F8", colour = "black"),
      panel.background = element_rect(fill = "#F8F8F8", colour = "#F8F8F8"),
      plot.background = element_rect(fill = "#F8F8F8", colour = "#F8F8F8"),
      legend.background = element_rect(fill = "#F8F8F8"), # transparent legend bg
      legend.box.background = element_rect(fill = "#F8F8F8"), # transparent legend panel
    )
  )
```

::: image-ref
Abbildung von [Laura Navarro Soler](https://r-graph-gallery.com/web-double-ridgeline-plot.html).
:::

## Story-Arc

![](./images/food_deserts.png){.lightbox}

::: {.image-ref}
Abbildung von [Corey Jones](https://public.tableau.com/app/profile/corey.jones/viz/FindingOasesInFoodDeserts/Dashboard1).
:::


## Grafik entfalten lassen 

::: {.columns}

:::: {.column-width="10%"}

::::
:::: {.column-width="80%"}

![](./images/water_world.png){width="80%"}

::::
:::: {.column-width="10%"}

::::
:::

::: {.image-ref}
Bild von [information is beautiful](https://informationisbeautiful.net/visualizations/water-world-distribution-of-the-all-the-water-in-all-the-world/).
:::


## Bewerten der Informationen 

![](./images/hollywood.png)

## Zus√§tzliche Informationen einbauen


```{r}
#| label: line_labels
#| fig-width: 14
#| fig-height: 7
#| echo: false

gapminder_line <- gapminder %>%
  filter(country %in% c("deu"), time >= 1900, time <= 2024) %>%
  drop_na(gini)

steuer <- gapminder_line %>%
  filter(time %in% c(1914, 1920, 1939, 1945, 1974, 1990, 1991, 1996, 2020), country == "deu") %>%
  arrange(time) %>%
  mutate(label = c("Beginn 1. WK", "Reichseinkommensteuer", "Beginn 2. WK", "Starke Anhebung durch Alliierte", "Einkommenssteuerreformgesetz", "Wiedervereinigung", "Linear-Progressiver Tarif", "Anhebung Freibetr√§ge", "Corona"))

p_line <- ggplot(data = gapminder_line, aes(x = time, y = gini)) +
  theme_bg_dark() +
  geom_line(
    data = gapminder_europe, aes(x = time, y = gini, group = country),
    color = "#F8F8F8", alpha = 0.2
  ) +
  geom_line(color = "#F4BA02", linewidth = 2) +
  geom_point(data = steuer) +
  geom_text_repel(
    data = steuer, aes(label = label),
    nudge_x = c(-2, 10, 10, -5, -4, -10, 0, 5, -2),
    nudge_y = c(8, 5, 5, -10, 7, -4, 10, -8, 6),
    color = "#F4BA02",
    fontface = "bold",
    size = 9 # Labels bei Punkten
  ) +
  xlim(1900, 2024) +
  labs(
    title = "Ungleichheit in Deutschland On the Rise?",
    subtitle = "Gini-Koeffizient von 1850 bis 2024",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  geom_richtext(
    data = data.frame(
      x = 1900, y = 20,
      label = "<b>Gini-Koeffizient</b>: <br> Ma√ü f√ºr Ungleichheit. <br> In diesem Fall Einkommen.<br>0 = vollkommen gleich <br> 100 = maximal ungleich."
    ),
    aes(x, y, label = label),
    hjust = 0, vjust = 0,
    fill = "#F4BA02", label.color = "#01364C",
    label.r = grid::unit(3, "pt"),
    size = 6 # Gr√∂√üe des Textkastens
  ) +
  theme(
    text = element_text(size = 18), # global: Achsen, Titel, Subtitle, etc.
    plot.title = element_text(size = 24, face = "bold"),
    plot.subtitle = element_text(size = 18),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14)
  )

p_line
```


## Labeln: `annotate()`



```{r}
#| label: annotate_gini
#| code-line-numbers: "20,21,22,23,24,25,26,27,28"
#| output-location: column

gapminder_line <- gapminder %>%
  filter(country %in% c("deu"), time >= 1900, time <= 2024) %>%
  drop_na(gini)

gapminder_europe <- gapminder %>%
  filter(world_4region == "europe", time >= 1900, time <= 2024) %>%
  drop_na(gini)

ggplot(data = gapminder_line, aes(x = time, y = gini)) +
  geom_line(data = gapminder_europe, aes(x = time, y = gini, group = country), color = "lightgrey", alpha = 0.5) +
  geom_smooth(color = "black") +
  geom_line(color = "#F4BA02", linewidth = 2) +
  theme_bg() +
  labs(
    title = "Ungleichheit in Europa On the Rise",
    subtitle = "1900 bis 2024",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  annotate(
    geom = "text", x = 1920, y = 49, label = "Deutschland",
    color = "#F4BA02", fontface = "bold", size = 4
  ) +
  annotate("segment",
    x = 1920, xend = 1918, y = 47, yend = 44,
    color = "#F4BA02", arrow = arrow(length = unit(0.2, "cm"))
  )
```




## üèã √úbung

::: {.columns}
::: {.column width="50%"}


::: {.exercise}
Baut ein Label in euren Plot ein. 
:::

:::

::: {.column width="50%"}
![](./images/label.jpg){.image-right}
:::
:::

::: {.image-ref}
Foto von <a href="https://unsplash.com/de/@an_doich?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Anastasiya Doicheva</a> auf <a href="https://unsplash.com/de/fotos/ein-rotes-tuch-an-dem-ein-weisses-etikett-hangt-J_UuEa_aIeI?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
      
:::

## Vergleichen


```{r}
#| label: merged_lineplot
#| echo: false
#| fig-width: 14
#| fig-height: 7
#| fig.showtext: true

library(showtext)

font_add_google("Playfair Display", family = "playfair")
showtext_auto()



p_line <- ggplot(data = gapminder_line, aes(x = time, y = gini)) +
  theme_bg_dark() +
  geom_line(
    data = gapminder_europe, aes(x = time, y = gini, group = country),
    color = "#F8F8F8", alpha = 0.1
  ) +
  geom_line(color = "#F4BA02", linewidth = 2) +
  geom_point(data = steuer) +
  geom_text_repel(
    data = steuer, aes(label = label),
    nudge_x = c(-2, 10, 10, -5, -4, -10, 0, 5, -2),
    nudge_y = c(8, 5, 5, -10, 7, -4, 10, -8, 6),
    color = "#F4BA02",
    fontface = "bold",
    size = 3,
    family = "playfair"
  ) +
  xlim(1900, 2024) +
  labs(
    title = "Ungleichheit in Deutschland On the Rise?",
    subtitle = "Gini-Koeffizient von 1850 bis 2024",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  geom_richtext(
    data = data.frame(
      x = 1990, y = 55,
      label = "<b>Gini-Koeffizient</b>: <br> Ma√ü f√ºr Ungleichheit. <br> In diesem Fall Einkommen.<br>0 = vollkommen gleich <br> 100 = maximal ungleich."
    ),
    family = "playfair",
    aes(x, y, label = label),
    hjust = 0, vjust = 0,
    fill = "#F4BA02", label.color = "#01364C",
    label.r = grid::unit(3, "pt"),
    size = 3
  ) +
  theme(
    text = element_text(size = 18, family = "playfair"), # global: Achsen, Titel, Subtitle, etc.
    plot.title = element_text(size = 24, face = "bold"),
    plot.subtitle = element_text(size = 18),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14)
  ) +
  ylim(c(15, 65))


gapminder_usa <- gapminder %>%
  filter(country %in% c("usa"), time >= 1850, time <= 2024) %>%
  drop_na(gini)

p_line_usa <- ggplot(data = gapminder_usa, aes(x = time, y = gini, color = country)) +
  geom_line(color = "#00e0e0") +
  theme_bg() +
  labs(
    subtitle = "Einkommens- und Erbschaftssteuer in den USA",
    x = "Jahr",
    y = "Gini-Koeffizient"
  ) +
  geom_richtext(
    data = data.frame(
      x = 1920, y = 25,
      label = "Zwischen 1930 und 1980 wurden in den Vereinigten Staaten <br> die h√∂chsten Einkommen durchschnittlich mit 81 Prozent besteuert <br> und die gr√∂√üten vererbten Verm√∂gen mit 74 Prozent."
    ), family = "playfair",
        color = "#F4BA02",
    aes(x, y, label = label),
    inherit.aes = FALSE,
    hjust = 0, vjust = 0,
     fill = NA, label.color = NA, # remove background and outline
    label.padding = grid::unit(rep(0, 4), "pt"), # remove padding
    size = 3
  ) +
  theme_bg_dark() +
    theme(
    text = element_text(size = 18, family = "playfair"), # global: Achsen, Titel, Subtitle, etc.
    plot.title = element_text(size = 24, face = "bold"),
    plot.subtitle = element_text(size = 18),
    axis.title = element_text(size = 16),
    axis.text = element_text(size = 14),
    legend.position = "none"
  ) +
  ylim(c(15, 65))





## Eine Vermogenssteuer hat das potenzial, Ungleichheit zu reduzieren, und die Abgabenlast von Konsumsteuern zu reduzieren.
## Die USA hatten in den 80 Jahren eine 80% Vermogenssteuer.


library(patchwork)


p_line +
  p_line_usa +
  plot_layout(widths = c(1, 1), axes = "collect_y")
```



## üèã √úbung

::: {.columns}
::: {.column width="50%"}

::: {.exercise}

1. Was w√§re die √úberschrift f√ºr eure Grafik, wenn sie in der Zeitung stehen w√ºrde?
1. Welche Infos sind noch notwendig, um die Grafik zu verstehen? Wo k√∂nnte man sie einbauen?
1. Soll die Abbildung aus mehreren Plots bestehen? In welcher Reihenfolge?

:::

:::

::: {.column width="50%"}

![](./images/news.jpg){.image-right}

:::
:::