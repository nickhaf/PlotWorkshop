---
title: "Einführung"
format: letterbox-revealjs
---

```{r}
#| echo: false

library(quartets)
library(tidyverse)
library(ggrepel)
source(here::here("src", "themes.R"))
```




# Plotting


# Motivation


## Datasaurus Dozen ([`quartets`-Paket](https://github.com/r-causal/quartets))

```{r}
#| echo: false

datasaurus_dozen |>
  group_by(dataset) |>
  summarise(mean_x = mean(x),
            var_x = var(x),
            mean_y = mean(y),
            var_y = var(y),
            cor = cor(x, y)) |>
  knitr::kable(digits = 2)
```

## 

```{r}
#| echo: false
#| fig-height: 8
#| fig-width: 12

ggplot(datasaurus_dozen, aes(x = x, y = y)) +
  geom_smooth(method = "lm", formula = "y ~ x") +
  facet_wrap(~dataset) +
  theme_bg() +
  ylim(0, 100)

```

## 

```{r}
#| echo: false
#| fig-height: 8
#| fig-width: 12


ggplot(datasaurus_dozen, aes(x = x, y = y)) +
  geom_smooth(method = "lm", formula = "y ~ x") +
  facet_wrap(~dataset, ncol = 5) +
  geom_point() +
  theme_bg() +
  ylim(0, 100)


```


## Warum ggplot2?

## Einfach!
- Simple, schnelle Beispiele


## Beautiful
- Beispiele verschönert


# Gallerie {background-image="images/gallery.jpg" background-size="1225px"}


## {background-color="white"}

:::{.columns}

:::{.column width="10%"}

:::

:::{.column width="80%"}

```{r}
#| echo: false
#| fig-width: 15
#| fig-height: 12

library(tidyverse)
library(ggtext)
library(patchwork)

library(showtext)
font_add_google("Roboto Mono", family = "special")

df_pw <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-14/passwords.csv') %>% 
  # Remove rows where the password is missing
  filter(!is.na(password))


df_pw_time <- 
  df_pw %>% 
  mutate(
    time = case_when(
      time_unit == "seconds" ~ value,
      time_unit == "minutes" ~ value * 60,
      time_unit == "hours" ~ value * 60 * 60,
      time_unit == "days" ~ value * 60 * 24,
      time_unit == "weeks" ~ value * 60 * 24 * 7,
      time_unit == "months" ~ value * 60 * 24 * 30,
      time_unit == "years" ~ value * 60 * 24 * 365,
      TRUE ~ NA_real_
    )
  ) 


plus <- 1000
df_pw_plot <-
  df_pw_time %>% 
  mutate(time = time + plus) %>% 
  add_row(rank = 501, time = 1)


labels <-
  df_pw_plot %>% 
  # Value > 90 selects those above 90 years!
  filter(value > 90) %>% 
  # Create label out of the password and its rank
  mutate(label = glue::glue("<b>{password}</b><br><span style='font-size:8pt'>Rank: {rank}</span>")) %>% 
  # These columns give the position of the labels
  add_column(
    x = c(33, 332, 401, 492),
    y = c(75000000, 90000000, 45000000, 48498112)
  )


main <- ggplot(df_pw_plot, aes(rank, time, color = category)) +
  # This segment represents the vertical lines
  geom_segment(
    aes(x = rank, xend = rank, y = 0, yend = time), 
    size = 0.5
  ) +
  # This rect is converted into the inner circle where we're going to place text
  # when converting the plot to circular coordinates.
  geom_rect(
    aes(xmin = 1, xmax = 501, ymin = 0, ymax = plus), 
    fill = "grey97", color = "grey97"
  ) + 
  
  # Add our custom grid lines for the radial axis.
  # These lines indicate one day, one week, one month and one year.
  geom_hline(aes(yintercept = (1 * 24 * 60 + plus)), color = "grey88") +
  geom_hline(aes(yintercept = (7 * 24 * 60 + plus)), color = "grey85") +
  geom_hline(aes(yintercept = (30 * 24 * 60 + plus)), color = "grey82") +
  geom_hline(aes(yintercept = (365 * 24 * 60 + plus)), color = "grey79") +
  
  # Add points on the end of each line
  geom_point(aes(size = time)) +
  
  # Polar axis (y-axis) is in log10 scale
  scale_y_log10(expand = c(0, 0)) +
  
  # Use the Prism color scale for the categories
  rcartocolor::scale_color_carto_d(palette = "Prism", guide = "none") +
  
  # Assign a range for the size of the dots
  scale_size(
    range = c(1, 8), 
    limits = c(plus, max(df_pw_plot$time)), 
    guide = "none"
  ) +
  
  # Make it circular!
  coord_polar() 


main <- main + 
  # Add labels with `geom_richtext()`
  geom_richtext(
    data = labels,
    aes(x = x, y = y, label = label, color = category),
     lineheight = 0.8,
     size = 2.5,
     family = "Roboto Mono",
     label.color = NA
  ) +
  # Regular text with `geom_text()`
  # Note that coordinates are explicitly passed here.
  geom_text(
    x = 500, y = 1.2,
    label = "********\nCracking\nYour Favorite\nPassword",
    family = "Roboto Mono Medium",
    size = 6,
    lineheight = 0.87,
    color = "grey60"
  ) +
  geom_text(
    x = 250, y = 0.25,
    label = "********",
    family = "Roboto Mono Medium",
    size = 6,
    lineheight = 0.87,
    color = "grey60"
  ) +
  geom_text(
    x = 250, y = 1.1,
    label = "Time it takes to crack the 500 most\ncommon passwords by online guessing.\nSorted by rank and colored by category.",
    family = "Roboto Mono",
    size = 2,
    lineheight = 0.87,
    color = "grey73"
  ) +
  geom_text(
    x = 250, y = 1.95,
    label = "Time is displayed on a logarithmic scale\nwith the rings representing one day,\none week, one month, and one year\n(from inner to outer ring).",
    family = "Roboto Mono",
    size = 2,
    lineheight = 0.87,
    color = "grey73"
  )

facet_data <- 
  df_pw_plot %>% 
  add_row(rank = 501, time = 1, category = unique(df_pw_plot$category)) %>% 
  # This is where we add line breaks
  mutate(
    cat_label = case_when(
      category == "cool-macho" ~ "cool-\nmacho",
      category == "nerdy-pop" ~ "nerdy-\npop",
      category == "password-related" ~ "password-\nrelated",
      category == "rebellious-rude" ~ "rebel-\nlious-\nrude",
      category == "simple-alphanumeric" ~ "simple-\nalpha-\nnumeric",
      TRUE ~ category
    )
  ) %>% 
  filter(!is.na(category))


# Much of the code is the same than the code above.

facet <- ggplot(facet_data, aes(rank, time, color = category)) +
  geom_segment(
    aes(x = rank, xend = rank, y = 0, yend = time), 
    size = 0.6
  ) +
  geom_rect(
    aes(xmin = 1, xmax = 501, ymin = 0, ymax = plus), 
    fill = "grey97", color = "grey97"
  ) + 
  geom_hline(aes(yintercept = (1 * 24 * 60 + plus)), color = "grey82", size = 0.2) +
  geom_hline(aes(yintercept = (7 * 24 * 60 + plus)), color = "grey79", size = 0.2) +
  geom_hline(aes(yintercept = (30 * 24 * 60 + plus)), color = "grey76", size = 0.2) +
  geom_hline(aes(yintercept = (365 * 24 * 60 + plus)), color = "grey73", size = 0.2) +
  geom_point(aes(size = time)) +
  
  # This is what adds the label within each circle
  geom_text(
    aes(label = cat_label, color = category),
    x = 500, y = 0,
    family = "Roboto Mono Medium",
    size = 2.5,
    lineheight = 0.87
  ) +
  # This is what wraps the panels for the categories into a layout of 2 rows
  facet_wrap(~ category, ncol = 2) +
  coord_polar() + 
  scale_y_log10(expand = c(0, 0)) + 
  rcartocolor::scale_color_carto_d(palette = "Prism", guide = "none") +
  scale_size(
    range = c(0.5, 7), 
    limits = c(plus, max(df_pw_plot$time)), 
    guide = "none"
  ) + 
  theme(
    strip.text = element_blank(), 
  )
  

# Customize the main panel (top-panel)
main <- main + 
  # This 'theme_void' adds a completely empty theme 
  theme_void() + 
  # These negative margins are VERY important to obtain a tight layout.
  # theme(
  #   plot.margin = margin(-50, -180, -70, -180, "lines"),
  # )
NULL
  
facet <- facet + 
  # Same theme_void for the lower panels
  theme_void() +
  # theme(
  #   # Negative spacing between panels, which means they overlap
  #   panel.spacing = unit(-8, "lines"),
  #   # Negative margin on top, to decrease blank space between these panels
  #   # and the main plot on top
  #   plot.margin = margin(-40, 50, 10, 50)
  # ) + 
  # # Adjust settings for the caption
  theme(
    plot.caption = element_text(
      family = "Roboto Mono Medium", 
      size = 20, 
      color = "grey60", 
      hjust = 5#, 
      # margin = margin(-50, 10, 30, 10)
    )
  ) + 
  # Add caption
  labs(caption = "Visualization by Cédric Scherer ∙ Data by Knowledge is Beautiful")


# Combine the two plots
# The '+' means to 'add' the two ggplot2 plots together.
panel <- (main + facet) + 
  plot_layout(
    ncol = 2, # Results in one plot on top and another on the bottom.
    heights = c(1, 0.28) # Height assigned to each plot
  ) 

panel
```

:::

::: {.column width = "10%"}

:::
:::

::: image-ref
Example from [The R Graph Gallery](https://r-graph-gallery.com/web-circular-lollipop-plot-with-ggplot2.html). 
:::



## Der best Plot jemals?

![](images/napoleon.png)


Verluste der napoleonischen Armee beim Russlandfeldzug 1812–1813, von Charles Joseph Minard. 
Es werden [6 Dimensionen]{.highlight} dargestellt!    


::: image-ref
Image from [Wikipedia](https://en.wikipedia.org/wiki/File:Minard.png). 
:::


## 

```{r}
#| echo: false
#| eval: false

# Load dataset from github (Surfer project)
data <- read.table("https://github.com/holtzy/data_to_viz/raw/master/Example_dataset/19_MapConnection.csv", header=T, sep=",")

# Download NASA night lights image
download.file("https://raw.githubusercontent.com/holtzy/data_to_viz/master/story/IMG/BlackMarble_2016_01deg.jpg",  destfile = "sessions/Einführung/images/BlackMarble_2016_01deg.jpg", mode = "wb")

# Count how many times we have each unique connexion + order by importance
summary=data %>% 
  dplyr::count(homelat,homelon,homecontinent, travellat,travellon,travelcontinent) %>%
  arrange(n)

# A function that makes a dateframe per connection (we will use these connections to plot each lines)
data_for_connection=function( dep_lon, dep_lat, arr_lon, arr_lat, group){
  inter <- geosphere::gcIntermediate(c(dep_lon, dep_lat), c(arr_lon, arr_lat), n=50, addStartEnd=TRUE, breakAtDateLine=F)             
  inter=data.frame(inter)
  inter$group=NA
  diff_of_lon=abs(dep_lon) + abs(arr_lon)
  if(diff_of_lon > 180){
    inter$group[ which(inter$lon>=0)]=paste(group, "A",sep="")
    inter$group[ which(inter$lon<0)]=paste(group, "B",sep="")
  }else{
    inter$group=group
  }
  return(inter)
}

# Création d'un dataframe complet avec les points de toutes les lignes à faire.
data_ready_plot=data.frame()
for(i in c(1:nrow(summary))){
  tmp=data_for_connection(summary$homelon[i], summary$homelat[i], summary$travellon[i], summary$travellat[i] , i)
  tmp$homecontinent=summary$homecontinent[i]
  tmp$n=summary$n[i]
  data_ready_plot=rbind(data_ready_plot, tmp)
}
data_ready_plot$homecontinent=factor(data_ready_plot$homecontinent, levels=c("Asia","Europe","Australia","Africa","North America","South America","Antarctica"))

saveRDS(data_ready_plot, "./sessions/Einführung/surfdata.rds")

```

```{r}
#| echo: false
#| eval: false

library(jpeg)

# Load picture and render
earth <- jpeg::readJPEG("./images/worldmap.jpg", native = TRUE)
earth <- grid::rasterGrob(earth, interpolate = TRUE)

data_ready_plot <- readRDS("./surfdata.rds")
# Plot
p <- ggplot() +
  annotation_custom(earth, xmin = -180, xmax = 180, ymin = -90, ymax = 90) +
  geom_line(data=data_ready_plot, aes(x=lon, y=lat, group=group, colour=homecontinent, alpha=n), size=0.3) +
  scale_color_brewer(palette="Set3") +
  theme_void() +
  theme(
        legend.position="none",
        panel.background = element_rect(fill = "black", colour = "black"), 
        panel.spacing=unit(c(0,0,0,0), "null"),
        plot.margin=grid::unit(c(0,0,0,0), "cm"),
  ) +
  ggplot2::annotate("text", x = -150, y = -45, hjust = 0, size = 8, label = paste("Where surfers travel."), color = "white") +
  ggplot2::annotate("text", x = -150, y = -51, hjust = 0, size = 5, label = paste("data-to-viz.com | NASA.gov | 10,000 #surf tweets recovered"), color = "white", alpha = 0.5) +
  #ggplot2::annotate("text", x = 160, y = -51, hjust = 1, size = 7, label = paste("Cacedédi Air-Guimzu 2018"), color = "white", alpha = 0.5) +
  xlim(-180,180) +
  ylim(-60,80) +
  scale_x_continuous(expand = c(0.006, 0.006)) +
  coord_equal() 

p
```


::: image-ref

Code von [https://www.data-to-viz.com/story/MapConnection.html].

:::



# {background-image="images/setup.jpg" background-size="1225px"}

::: {.absolute left="5%" top="5%" style="color:#F8F8F8;"}
Basic Setup
:::

::: image-ref
Foto von <a href="https://unsplash.com/de/@adigold1?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Adi Goldstein</a> auf <a href="https://unsplash.com/de/fotos/graustufenfotografie-eines-mannes-im-gestreiften-hemd-rgkKFn5Ysb0?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
:::




## RStudio Projekte

Hilft ungemein beim Organisieren von Dateien und Code!


\

::: {.exercise}
Erstelle ein RStudio Projekt in einem Ordner für diesen Workshop.
:::


## Pfade

[here](https://here.r-lib.org/) ist ein Paket zum Erstellen von Dateipfaden. 
Dadurch können Probleme mit relativen und absoluten Pfaden vermieden werden. 

`C:\Users\hafiznij\Documents\GitHub\IRT_workshop\data\gapminder_dat.rds` wird zu:  
`here::here("data", "gapminder_dat.rds")`. 


::: {.panel-tabset}

### Übung

::: {.exercise}

Lade die gapminder-Daten von [GitHub](https://github.com/nickhaf/PlotWorkshop/blob/main/data/gapminder_dat.rds) herunter und in R ein. 

:::



### Lösung

```{r}
# install.packages("here")
gapminder <- readRDS(here::here("data", "gapminder_dat.rds"))
```

:::

## Daten

:::{.columns}
:::{.column width = "50%"}


\
\

[Gapminder](https://www.gapminder.org/tools/#$chart-type=bubbles&url=v2) ist ein non-profit Projekt mit dem Ziel, mit [global misconceptions]{.highlight} aufzuräumen. 
Grundlage dafür ist ein Datensatz mit sozioökonomischen Indikatoren für fast alle Länder der Welt über mehrere Jahrzehnte. 


:::
:::{.column width = "50%"}


![](./images/factfulness.jpg){.image-right}

:::
:::

::: image-ref
Bild von [Amazon](https://m.media-amazon.com/images/I/71KH-wJcv3L.jpg). 
:::


## Quiz {background-image="images/world.jpg" background-size="1225px"}

::: {.exercise}
Öffne [Mentimeter](https://www.mentimeter.com/app/presentation/alep3cierpqrz5cwkm6v2ege1h1tvhbi/edit?question=nw21zffqg1ti) und bearbeite das Quiz. 
:::

::: image-ref
Fragen von [Gapminder](https://upgrader.gapminder.org/).  
Foto von <a href="https://unsplash.com/de/@nasa?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">NASA</a> auf <a href="https://unsplash.com/de/fotos/foto-aus-dem-weltraum-Q1p7bh3SHj8?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
      
:::



# Plot-Typen

## Scatterplot

::: {.panel-tabset}

### Plot
```{r}
#| label: example-scatter
#| fig-width: 14
#| fig-height: 7
#| echo: false

gapminder_2019 <- gapminder %>% 
  filter(time == 2019)
  
p_scatter <- ggplot(data = gapminder_2019, aes(x = gini, y = hapiscore_whr, color = world_6region)) +
  geom_point(size = 3) 

p_scatter

```

### Code

```{r}
#| label: example-scatter
#| eval: false
```


:::

## Scatterplot
::: {.columns}
:::{.column width = "50%"}

:::{.steckbrief}
[Datentyp]{.highlight}  Numerisch

[Achtung]{.highlight} Overplotting


:::

:::{.tag}
[Link test](https://quarto.org/docs/reference/formats/html.html)
:::

:::
:::{.column width = "50%"}
```{r}
#| echo: false

p_scatter

```
:::
:::



## Barplot
::: {.panel-tabset}

### Plot
```{r}
#| label: example-bar
#| fig-width: 14
#| fig-height: 7
#| echo: false

gapminder_2019_bar <- gapminder_2019 %>% 
  filter(world_6region == "europe_central_asia") %>% 
drop_na(unicode_region_subtag, gini)

p_bar <- ggplot(data = gapminder_2019_bar, aes(x = reorder(unicode_region_subtag, gini), y = gini)) +
  geom_bar(stat = "identity", color = "black", fill = "#F4BA02") +
  theme_bg()

p_bar

```

### Code

```{r}
#| label: example-bar
#| eval: false
```


:::

## Barplot
::: {.columns}
:::{.column width = "50%"}

:::{.steckbrief}
[Datentyp]{.highlight}  

[Achtung]{.highlight} 

:::


## Histogram

## Lineplot

::: {.panel-tabset}

### Plot
```{r}
#| label: example-line
#| fig-width: 14
#| fig-height: 7
#| echo: false

gapminder_line <- gapminder %>% 
  filter(country %in% c("deu"), time >=1900, time <= 2024) %>% 
  drop_na(gini)

p_line <- ggplot(data = gapminder_line, aes(x = time, y = gini, color = country)) +
geom_line() +  
theme_bg() +
labs(title = "Ungleichheit in Deutschland On the Rise", 
     subtitle = "Gini-Koeffizient von 1900 bis 2024",
     x = "Jahr",
     y = "Gini-Koeffizient")

p_line

```

### Code

```{r}
#| label: example-line
#| eval: false
```


:::


## Lineplot
::: {.columns}
:::{.column width = "50%"}

:::{.steckbrief}
[Datentyp]{.highlight}  

[Gut für]{.highlight} Zeitreihen

[Achtung]{.highlight} 

:::

## Boxplot

## Karten

## Spider-Chart

## Kombiniert
- Co2 with grey scale
- greens with green scale

# Plotly

## gganimate

## Generative Art


## {background-image="images/habeck.jpeg" background-size="1225px"}}

::: image-ref
Bild von [Static](https://static.ksta.de/__images/2025/04/24/b3b17a0b-1da5-4e0f-9d6e-d321b248e1fa.jpeg?q=75&q=70&rect=0,259,4000,2250&w=2000&h=1334&fm=jpeg&s=cd6fd9eb8760f10aad114f59d21d74ce).
:::

